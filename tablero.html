<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIG economia social</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>  


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
 
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/modules/marker-clusters.js"></script>
<script src="https://code.highcharts.com/modules/coloraxis.js"></script>
<script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>



</head>
<style>
#contenedorClusters {
    min-width: 310px;
    max-width: 700px;
    height: 600px;
    margin: 0 auto;
}




  #map { height: 340px; }
  #mapMuns { height: 340px; }



  #piramide {
    height: 500px;
    max-width: 100%
  }

  #graficaXmunicipio {
    height: 600px;
    width: 100%
  }

.highcharts-figure,
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}

.highcharts-description {
    margin: 0.3rem 10px;
}


.navbar-item img {
  max-height: 3rem;
}
</style>
<body>
 
<section class="section">
<nav class="navbar is-transparent is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="#">
      <img src="logo.png" alt="Logo" width="224" height="28">
    </a>
  </div>
</nav>
</section>


  <section class="section">
    <div class="columns">
      <aside class="column is-one-quarter">
        <nav class="menu">
          <p class="menu-label">General</p>
          <ul class="menu-list">
            <li><a class="is-active">Inicio</a></li>
            <li onclick="window.location.href='cuestionario.html'"><a>Captura</a></li>
            <li><a>Visualización</a></li>
          </ul>
          <p class="menu-label">Reportes</p>
          <ul class="menu-list">
            <li><a>Mensuales</a></li>
            <li><a>Anuales</a></li>
          </ul>
        </nav>
      </aside>

      <main class="column">
        <div class="box">
          <h2 class="title is-4">Sistema de información geográfica de economia social</h2>
          <p>Este es el sistema de información geográfica de empresas sociales del estado de México.</p>
        </div>

          <div id="parrafo" class="columns is-multiline">
            <div class="column is-one-third">
                <div class="box has-text-centered">


                <h3 class="title is-5">Selecciona un municipio</h3>
                <form>
                    <div class="field">                    
                    <div class="control">
                        <div class="select">
                            <select id="municipios" class="select">
                                <option value="" disabled selected>Entidad completa</option>
                        </select>
                        </div>
                    </div>
                    </div>

                </form>                    

                    
                </div>
            </div>
         
            

          
            <div class="column is-one-third">
                <div class="box has-text-centered">                    
                    <h3 class="title is-5">Total de empresas registradas</h3>
                    <br>
                    <h2 class="subtitle">0</h2>                    
                </div>
            </div>
          
          
          

          
            <div class="column is-one-third">
                <div class="box has-text-centered">                    
                    <h3 class="title is-5">Total empresas en INEGI</h3>
                    <br>
                    <h2 class="subtitle">0</h2>                    
                </div>
            </div>
        </div> 
        
        




          <div id="parrafo" class="columns is-multiline">
            <div class="column is-one-third">
                <div class="box has-text-centered">                    
                    <h3 class="title is-5">Total de personas beneficiadas</h3>
                    <br>
                    <h2 class="subtitle">0</h2>                    
                </div>
            </div>
         
            

          
            <div class="column is-one-third">
                <div class="box has-text-centered">                    
                    <h3 class="title is-5">Hombres</h3>
                    <br>
                    <h2 class="subtitle">0</h2>                    
                </div>
            </div>
          
          
          

          
            <div class="column is-one-third">
                <div class="box has-text-centered">                    
                    <h3 class="title is-5">Mujeres</h3>
                    <br>
                    <h2 class="subtitle">0</h2>                    
                </div>
            </div>
        </div>         



          <div id="parrafo" class="columns is-multiline">
            <div class="column is-one-third">
                <div class="box has-text-centered">
                  <p class="title is-5">Uicacion a nivel nacional</p>
                  <br>

                    <div id="map"></div>
                      <p class="subtitle is-6" id="totUnidades">0.0</p>
                    
                </div>
            </div>       

            
            <div class="column is-one-third">
                <div class="box has-text-centered">
                  <p class="title is-5">Generos</p>
                  <br>

                  <figure class="highcharts-figure">
                    <div id="containerGen"></div>
                </figure>


                  <p class="subtitle is-6" id="totUnidades">0.0</p>
                    
                </div>
            </div>            
          
          
          

          
            <div class="column is-one-third">
                <div class="box has-text-centered">
                  <p class="title is-5">Municipios</p>
                  <br>

                  <div id="mapMuns"></div>
                  <p class="subtitle is-6" id="totUnidades">0.0</p>
                    
                </div>
            </div>
          </div>          




          <div id="parrafo" class="columns is-multiline">
            <div class="column is-full">
                <div class="box has-text-centered">
                  <p class="title is-5">Piramide poblacional</p>
                  <br>

                  <figure class="highcharts-figure">
                    <div id="piramide"></div>
                    <p class="highcharts-description">Composición de la población por rangos de edades</p>
                  </figure>
                      <p class="subtitle is-6" id="totUnidades">0.0</p>
                    
                </div>
            </div>
                     
            

          

          </div>

          <div id="parrafo" class="columns is-multiline">
            <div class="column is-full">
                <div class="box has-text-centered">
                    <figure class="highcharts-figure">
                        <div id="graficaXmunicipio"></div>
                    </figure>                    
                </div>
            </div>
          </div>



          

  

        </div>
        </div>
      </main>
    </div>
  </section>















</body>
<script>

(async () => {

const topology = await fetch(
    'https://code.highcharts.com/mapdata/custom/europe.topo.json'
).then(response => response.json());

const data = await fetch(
    'https://www.highcharts.com/samples/data/european-train-stations-near-airports.json'
).then(response => response.json());

Highcharts.mapChart('contenedorClusters', {
    chart: {
        map: topology
    },
    title: {
        text: 'European Train Stations Near Airports',
        align: 'left'
    },
    subtitle: {
        text: 'Source: <a href="https://github.com/trainline-eu/stations">' +
                'github.com/trainline-eu/stations</a>',
        align: 'left'
    },
    mapNavigation: {
        enabled: true
    },
    tooltip: {
        headerFormat: '',
        pointFormat: '<b>{point.name}</b><br>Lat: {point.lat:.2f}, Lon: ' +
            '{point.lon:.2f}'
    },
    colorAxis: {
        min: 0,
        max: 20
    },
    plotOptions: {
        mappoint: {
            cluster: {
                enabled: true,
                allowOverlap: false,
                animation: {
                    duration: 450
                },
                layoutAlgorithm: {
                    type: 'grid',
                    gridSize: 70
                },
                zones: [{
                    from: 1,
                    to: 4,
                    marker: {
                        radius: 13
                    }
                }, {
                    from: 5,
                    to: 9,
                    marker: {
                        radius: 15
                    }
                }, {
                    from: 10,
                    to: 15,
                    marker: {
                        radius: 17
                    }
                }, {
                    from: 16,
                    to: 20,
                    marker: {
                        radius: 19
                    }
                }, {
                    from: 21,
                    to: 100,
                    marker: {
                        radius: 21
                    }
                }]
            }
        }
    },
    series: [{
        name: 'Europe',
        accessibility: {
            exposeAsGroupOnly: true
        },
        borderColor: '#A0A0A0',
        nullColor: 'rgba(177, 244, 177, 0.5)',
        showInLegend: false
    }, {
        type: 'mappoint',
        enableMouseTracking: true,
        accessibility: {
            point: {
                descriptionFormat: '{#if isCluster}' +
                        'Grouping of {clusterPointsAmount} points.' +
                        '{else}' +
                        '{name}, country code: {country}.' +
                        '{/if}'
            }
        },
        colorKey: 'clusterPointsAmount',
        name: 'Cities',
        data: data,
        color: Highcharts.getOptions().colors[5],
        marker: {
            lineWidth: 1,
            lineColor: '#fff',
            symbol: 'mapmarker',
            radius: 8
        },
        dataLabels: {
            verticalAlign: 'top'
        }
    }]
});

})();








function graficaGeneros(){

  Highcharts.setOptions({
    colors: Highcharts.getOptions().colors.map(function (color) {
        return {
            radialGradient: {
                cx: 0.5,
                cy: 0.3,
                r: 0.7
            },
            stops: [
                [0, color],
                [1, Highcharts.color(color).brighten(-0.3).get('rgb')] // darken
            ]
        };
    })
});

// Build the chart
Highcharts.chart('containerGen', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Representación de los generos en un pie'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    accessibility: {
        point: {
            valueSuffix: '%'
        }
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<span style="font-size: 1.2em"><b>{point.name}</b>' +
                    '</span><br>' +
                    '<span style="opacity: 0.6">{point.percentage:.1f} ' +
                    '%</span>',
                connectorColor: 'rgba(128,128,128,0.5)'
            }
        }
    },
    series: [{
        name: 'Share',
        data: [
            { name: 'Masculino', y: 4780 },
            { name: 'Femenino', y: 4800 },
            { name: 'No binario', y: 420 },
        ]
    }]
});

}



function barras(){
Highcharts.chart('graficaXmunicipio', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'Empresas sociales por municipio'
    },
    subtitle: {
        text: 'Source: SEDECO (2025)</a>'
    },
    xAxis: {
        type: 'category',
        labels: {
            autoRotation: [-45, -90],
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            }
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: '# empresas'
        }
    },
    legend: {
        enabled: false
    },
    tooltip: {
        pointFormat: '# empresas: <b>{point.y:.1f}</b>'
    },
    series: [{
        name: 'Population',
        colors : [
            "#9b20d9", "#9215ac", "#861ec9", "#7a17e6", "#7010f9", "#691af3",
            "#6225ed", "#5b30e7", "#533be1", "#4c46db", "#4551d5", "#3e5ccf",
            "#3667c9", "#2f72c3", "#277dbd", "#1f88b7", "#1693b1", "#0a9eaa",
            "#03c69b", "#00f194", "#9b22d7", "#9420cd", "#8c1dc3", "#821bbb",
            "#7818b2", "#7016aa", "#6813a2", "#60119a", "#580f92", "#500d8a",
            "#480b82", "#40087a", "#380672", "#30046a", "#280262", "#20005a",
            "#5803c3", "#5f05bc", "#6607b5", "#6d09ae", "#740ba7", "#7b0da0",
            "#820f99", "#891192", "#90138b", "#971584", "#9e177d", "#a51976",
            "#ac1b6f", "#b31d68", "#ba1f61", "#c1215a", "#c82353", "#cf253c",
            "#d62735", "#dd292e", "#e42b27", "#eb2d20", "#f22f19", "#f93112",
            "#ff330b", "#9003d1", "#8a07c9", "#840bbf", "#7e0fb7", "#7813ad",
            "#7217a3", "#6c1b99", "#661f8f", "#602385", "#5a277b", "#542b71",
            "#4e2f67", "#48335d", "#423753", "#3c3b49", "#363f3f", "#303335",
            "#2a272b", "#9b25e1", "#9427db", "#8c29d5", "#842bcb", "#7b2dc3",
            "#732fbb", "#6a31b3", "#6233ab", "#5935a3", "#50379b", "#483993",
            "#3f3b8b", "#373d83", "#2e3f7b", "#263173", "#1d336b", "#153563",
            "#0c375b", "#033953", "#003b4b", "#032745", "#05253f", "#072339",
            "#092133", "#0b1f2d", "#0d1d27", "#0f1b21", "#11191b", "#131715",
            "#14151A", "#1A1D25", "#202530", "#262D3B", "#2C3546", "#323D51",
            "#38455C", "#3E4D67", "#445572", "#4A5D7D", "#506588", "#566D93",
            "#5C759E", "#627DA9", "#6885B4", "#6E8DBF", "#7495CA"
            ],
        colorByPoint: true,
        groupPadding: 0,
        data: ordenarMunicipios(),
        dataLabels: {
            enabled: true,
            rotation: -90,
            color: '#FFFFFF',
            inside: true,
            verticalAlign: 'top',
            format: '{point.y:.1f}', // one decimal
            y: 10, // 10 pixels down from the top
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            }
        }
    }]
});

}


function ordenarMunicipios(){
    const municipios=
    [
            ["Acambay de Ruiz Castañeda", 42],
            ["Acolman", 87],
            ["Aculco", 15],
            ["Almoloya de Alquisiras", 63],
            ["Almoloya de Juárez", 98],
            ["Almoloya del Río", 23],
            ["Amanalco", 74],
            ["Amatepec", 56],
            ["Amecameca", 31],
            ["Apaxco", 90],
            ["Atenco", 12],
            ["Atizapán", 45],
            ["Atizapán de Zaragoza", 67],
            ["Atlacomulco", 81],
            ["Atlautla", 39],
            ["Axapusco", 99],
            ["Ayapango", 27],
            ["Calimaya", 58],
            ["Capulhuac", 36],
            ["Coacalco de Berriozábal", 71],
            ["Coatepec Harinas", 49],
            ["Cocotitlán", 88],
            ["Coyotepec", 14],
            ["Cuautitlán", 53],
            ["Cuautitlán Izcalli", 95],
            ["Chalco", 61],
            ["Chapa de Mota", 20],
            ["Chapultepec", 77],
            ["Chiautla", 33],
            ["Chicoloapan", 85],
            ["Chiconcuac", 47],
            ["Chimalhuacán", 92],
            ["Donato Guerra", 30],
            ["Ecatepec de Morelos", 100],
            ["Ecatzingo", 41],
            ["Huehuetoca", 66],
            ["Hueypoxtla", 18],
            ["Huixquilucan", 79],
            ["Isidro Fabela", 25],
            ["Ixtapaluca", 89],
            ["Ixtapan de la Sal", 55],
            ["Ixtapan del Oro", 37],
            ["Ixtlahuaca", 83],
            ["Xalatlaco", 50],
            ["Jaltenco", 21],
            ["Jilotepec", 72],
            ["Jilotzingo", 44],
            ["Jiquipilco", 97],
            ["Jocotitlán", 60],
            ["Joquicingo", 29],
            ["Juchitepec", 84],
            ["Lerma", 46],
            ["Malinalco", 93],
            ["Melchor Ocampo", 32],
            ["Metepec", 78],
            ["Mexicaltzingo", 19],
            ["Morelos", 64],
            ["Naucalpan de Juárez", 96],
            ["Nextlalpan", 35],
            ["Nezahualcóyotl", 86],
            ["Nicolás Romero", 48],
            ["Nopaltepec", 22],
            ["Ocoyoacac", 70],
            ["Ocuilan", 40],
            ["El Oro", 82],
            ["Otumba", 57],
            ["Otzoloapan", 26],
            ["Otzolotepec", 91],
            ["Ozumba", 34],
            ["Papalotla", 76],
            ["La Paz", 16],
            ["Polotitlán", 68],
            ["Rayón", 43],
            ["San Antonio la Isla", 75],
            ["San Felipe del Progreso", 51],
            ["San Martín de las Pirámides", 80],
            ["San Mateo Atenco", 28],
            ["San Simón de Guerrero", 62],
            ["Santo Tomás", 17],
            ["Soyaniquilpan de Juárez", 56],
            ["Sultepec", 38],
            ["Tecámac", 94],
            ["Tejupilco", 59],
            ["Temamatla", 24],
            ["Temascalapa", 65],
            ["Temascalcingo", 11],
            ["Temascaltepec", 73],
            ["Temoaya", 52],
            ["Tenancingo", 69],
            ["Tenango del Aire", 13],
            ["Tenango del Valle", 54],
            ["Teoloyucán", 31],
            ["Teotihuacán", 88],
            ["Tepetlaoxtoc", 42],
            ["Tepetlixpa", 20],
            ["Tepotzotlán", 77],
            ["Tequixquiac", 90],
            ["Texcaltitlán", 15],
            ["Texcalyacac", 63],
            ["Texcoco", 98],
            ["Tezoyuca", 23],
            ["Tianguistenco", 74],
            ["Timilpan", 56],
            ["Tlalmanalco", 31],
            ["Tlalnepantla de Baz", 100],
            ["Tlatlaya", 41],
            ["Toluca", 66],
            ["Tonatico", 18],
            ["Tultepec", 79],
            ["Tultitlán", 25],
            ["Valle de Bravo", 89]
    ]

    // Ordenar por el segundo valor (númerico) de mayor a menor
    return municipios.sort((a, b) => b[1] - a[1]);

}

function piramide(){
// Custom template helper
Highcharts.Templating.helpers.abs = value => Math.abs(value);

// Age categories
const categories = [
    '0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-40', '40-45',
    '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80-84',
    '80+'
];

Highcharts.chart('piramide', {
    chart: {
        type: 'bar'
    },
    title: {
        text: 'Piramide poblacional estado de México'
    },
    subtitle: {
        text: 'Source: <a ' +
            'href="https://countryeconomy.com/demography/population-structure/andorra"' + 'target="_blank">countryeconomy.com</a>'
    },
    accessibility: {
        point: {
            valueDescriptionFormat: '{index}. Age {xDescription}, {value}%.'
        }
    },
    xAxis: [{
        categories: categories,
        reversed: false,
        labels: {
            step: 1
        },
        accessibility: {
            description: 'Age (male)'
        }
    }, { // mirror axis on right side
        opposite: true,
        reversed: false,
        categories: categories,
        linkedTo: 0,
        labels: {
            step: 1
        },
        accessibility: {
            description: 'Age (female)'
        }
    }],
    yAxis: {
        title: {
            text: null
        },
        labels: {
            format: '{abs value}%'
        },
        accessibility: {
            description: 'Percentage population',
            rangeDescription: 'Range: 0 to 5%'
        }
    },

    plotOptions: {
        series: {
            stacking: 'normal',
            borderRadius: '50%'
        }
    },

    tooltip: {
        format: '<b>{series.name}, age {point.category}</b><br/>' +
            'Population: {(abs point.y):.2f}%'
    },

    series: [{
        name: 'Male',
        data: [
            -1.38, -2.09, -2.45, -2.71, -2.97,
            -3.69, -4.04, -3.81, -4.19, -4.61,
            -4.56, -4.21, -3.53, -2.55, -1.82,
            -1.46, -0.78, -0.71
        ]
    }, {
        name: 'Female',
        data: [
            1.35, 1.98, 2.43, 2.39, 2.71,
            3.02, 3.50, 3.52, 4.03, 4.40,
            4.17, 3.88, 3.29, 2.42, 1.80,
            1.39, 0.99, 1.15
        ]
    }]
});  
}








function crearMapaMuns(i){
 const map = L.map('mapMuns');

const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);


  // Cargar el archivo GeoJSON desde localhost
  fetch('https://geografia.mx/assets/geojson/municipios.json') // Cambia la ruta según tu archivo
      .then(response => response.json())
      .then(data => {
          // Filtrar y obtener un feature específico
          const singleFeature = L.geoJSON(data, {
              filter: feature => feature.properties.CVE_ENT === i, // Cambia "FeatureEspecifico" según la propiedad
              style: {
                  color: 'blue', // Estilo del feature
                  weight: 2
              }
          });

          // Agregar el feature filtrado al mapa
          singleFeature.addTo(map);

          // Centrar el mapa en el feature
          map.fitBounds(singleFeature.getBounds());
      })
      .catch(error => {
          console.error('Error al cargar el archivo GeoJSON:', error);
      });

}




function crearMapaEdo(CVE_ENT){
 const map = L.map('map');

const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);


  // Cargar el archivo GeoJSON desde localhost
  fetch('https://geografia.mx/assets/geojson/estados.json') // Cambia la ruta según tu archivo
      .then(response => response.json())
      .then(data => {
          // Filtrar y obtener un feature específico
          const singleFeature = L.geoJSON(data, {
              filter: feature => feature.properties.CVE_ENT === CVE_ENT, // Cambia "FeatureEspecifico" según la propiedad
              style: {
                  color: 'red', // Estilo del feature
                  weight: 2
              }
          });

          // Agregar el feature filtrado al mapa
          singleFeature.addTo(map);

          // Centrar el mapa en el feature
          map.fitBounds(singleFeature.getBounds());
      })
      .catch(error => {
          console.error('Error al cargar el archivo GeoJSON:', error);
      });
}



async function loadCBX(CVE_ENT){

  try {
        // Realizar fetch al archivo GeoJSON
        const respuesta = await fetch('https://geografia.mx/assets/geojson/municipios.json');
        const geojson = await respuesta.json(); // Convertir la respuesta a JSON

        // Obtener referencia al combobox
        const comboBox = document.getElementById('municipios');

        // Filtrar las características para encontrar "Monterrey"
        const muns = geojson.features.filter(feature => feature.properties.CVE_ENT === CVE_ENT);

        // Llenar el combobox con el resultado filtrado
        muns.forEach(feature => {
          const option = document.createElement('option');
          option.value = feature.properties.CVE_MUN; // Asignar el "id" como valor
          option.textContent = feature.properties.NOMGEO; // Mostrar el "nombre"
          comboBox.appendChild(option);
        });

        const totUnidades = document.getElementById('totUnidades');
          // Cambiar el contenido del elemento que muestra el total de municipios          
          totUnidades.textContent = muns.length;         




      } catch (error) {
        console.error('Error al cargar el archivo GeoJSON:', error);
      }
}

// Ejecutar la función cuando la página se cargue

window.onload=loadCBX("15");
window.onload = crearMapaEdo("15");
window.onload = crearMapaMuns("15");
window.onload = piramide();
window.onload = barras();
window.onload = graficaGeneros();


</script>
</html>
